<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>음악 재생기</title>
    <style>
        #audioPlayer {
            width: 300px;
            margin: 20px;
        }

        #progressBar, #volumeBar {
            width: 100%;
            height: 10px;
            background-color: #ccc;
            position: relative;
            margin-top: 10px;
        }

        #currentProgress, #currentVolume {
            height: 100%;
            position: absqolute;
        }

        #currentProgress {
            background-color: #4caf50;
        }

        #currentVolume {
            background-color: #2196F3;
        }

        #playButton, #repeatButton, #prevButton, #nextButton{
            margin-top: 20px;
            cursor: pointer;
            padding: 10px;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 5px;
            margin-right: 10px;
        }

        #volumeControl{
            width: 20px;
            height: 20px;
            margin-top: 20px;
            cursor: pointer;
            padding: 10px;
            border: none;
            border-radius: 5px;
            margin-right: 10px;
        }
        

        #volumeControl.muted {
            background-color: #ff4444; /* 소리 꺼짐일 때 색 변경 */
        }

        #volumeControl.muted:hover {
            background-color: #cc0000; /* 소리 꺼짐일 때 hover 시 색 변경 */
        }

        #currentTime, #totalTime {
            margin-top: 10px;
        }
    </style>
</head>
<body>

<audio id="audioPlayer">
    <source src="./music/Perfect night.mp3" type="audio/mp3">
    Your browser does not support the audio element.
</audio>

<button id="prevButton">이전 곡</button>
<button id="playButton">음악 재생</button>
<button id="nextButton">다음 곡</button>
<img src="./icon/volume.png" alt="" id="volumeControl">
<button id="repeatButton">반복 재생</button>

<div id="progressBar">
    <div id="currentProgress"></div>
</div>

<div id="volumeBar">
    <div id="currentVolume"></div>
</div>

<div id="currentTime">재생 시간: 0:00</div>
<div id="totalTime">전체 시간: 0:00</div>

<script>
    const audio = document.getElementById('audioPlayer');
    const progressBar = document.getElementById('progressBar');
    const currentProgress = document.getElementById('currentProgress');
    const volumeBar = document.getElementById('volumeBar');
    const currentVolume = document.getElementById('currentVolume');
    const playButton = document.getElementById('playButton');
    const volumeControl = document.getElementById('volumeControl');
    const repeatButton = document.getElementById('repeatButton');
    const prevButton = document.getElementById('prevButton');
    const nextButton = document.getElementById('nextButton');
    const currentTimeDisplay = document.getElementById('currentTime');
    const totalTimeDisplay = document.getElementById('totalTime');

    const playlist = ["music/Drama.mp3", "music/Baddie.mp3", "music/Seven.mp3", "music/Love Lee.mp3","music/사랑은 늘 도망가.mp3","music/후라이의 꿈.mp3", "music/You&me.mp3", "music/헤어지자 말해요.mp3", "music/Do or die.mp3", "music/모래 알갱이.mp3", "music/우리들의 블루스.mp3"];
    let currentTrackIndex = 0;
    let isRepeat = false;

    playButton.addEventListener('click', togglePlay);
    volumeControl.addEventListener('click', toggleVolumeBarVisibility);
    repeatButton.addEventListener('click', toggleRepeat);
    prevButton.addEventListener('click', playPrevTrack);
    nextButton.addEventListener('click', playNextTrack);

    audio.addEventListener('timeupdate', updateProgressBarAndTime);
    audio.addEventListener('durationchange', updateTotalTime);
    audio.addEventListener('ended', handleSongEnd);
    audio.addEventListener('volumechange', updateVolumeBar);

    progressBar.addEventListener('click', (event) => {
        const clickedPosition = event.clientX - progressBar.getBoundingClientRect().left;
        const newPosition = (clickedPosition / progressBar.clientWidth) * audio.duration;
        audio.currentTime = newPosition;
    });

    volumeBar.addEventListener('click', (event) => {
        const clickedPosition = event.clientX - volumeBar.getBoundingClientRect().left;
        const newVolume = clickedPosition / volumeBar.clientWidth;
        audio.volume = newVolume;
    });

    function togglePlay() {
        if (audio.paused) {
            audio.play();
            playButton.innerText = '일시 정지';
        } else {
            audio.pause();
            playButton.innerText = '음악 재생';
        }
    }

    function toggleVolumeBarVisibility() {
        const isVisible = volumeBar.style.display === 'block';
        volumeBar.style.display = isVisible ? 'none' : 'block';
    }

    function toggleRepeat() {
        isRepeat = !isRepeat;
        if (isRepeat) {
            repeatButton.innerText = '반복 중지';
        } else {
            repeatButton.innerText = '반복 재생';
        }
    }

    function playPrevTrack() {
        currentTrackIndex = (currentTrackIndex - 1 + playlist.length) % playlist.length;
        loadTrack();
    }

    function playNextTrack() {
        currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
        loadTrack();
    }

    function loadTrack() {
        audio.src = playlist[currentTrackIndex];
        audio.load();
        playButton.innerText = '음악 재생';
        audio.play();
    }

    function handleSongEnd() {
        if (isRepeat) {
            // 반복 재생이 활성화된 경우 다음 곡으로 넘어가지 않고 현재 곡을 다시 재생
            audio.currentTime = 0;
            audio.play();
        } else {
            // 반복 재생이 비활성화된 경우 다음 곡으로 넘어감
            playNextTrack();
        }
    }

    function updateProgressBarAndTime() {
        const progress = (audio.currentTime / audio.duration) * 100;
        currentProgress.style.width = `${progress}%`;

        const minutes = Math.floor(audio.currentTime / 60);
        const seconds = Math.floor(audio.currentTime % 60);
        currentTimeDisplay.innerText = `재생 시간: ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
    }

    function updateTotalTime() {
        const minutes = Math.floor(audio.duration / 60);
        const seconds = Math.floor(audio.duration % 60);
        totalTimeDisplay.innerText = `전체 시간: ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
    }

    function updateVolumeBar() {
        const volume = audio.volume * 100;
        currentVolume.style.width = `${volume}%`;

        // 소리가 0이면 버튼에 소리 꺼짐이라고 표시
        if (volume === 0) {
            volumeControl.src = "icon/mute.png";
            volumeControl.classList.add('muted');
        } else {
            volumeControl.src = "icon/volume.png";
            volumeControl.classList.remove('muted');
        }
    }
</script>

</body>
</html>
